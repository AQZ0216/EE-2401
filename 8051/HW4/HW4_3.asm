	DQ	EQU	P1.0
	CLK	EQU	P1.1
	RST	EQU	P1.2
	THI	EQU	P1.3
	TLO	EQU	P1.4
	TCOM	EQU	P1.5
	FURN	EQU	P1.6

	ORG	0000H
	CLR	FURN
CONF:	SETB	RST     ;INITIATE TRANSFER
	MOV 	A, #0CH	;WRITE CONFIG
	CALL	SEND
	MOV 	A, #0AH	;CPU=1, 1-SHOT =0
	CALL	SEND
	CLR	RST

	SETB	RST
	MOV	A, #01H	;WRITE TH
	CALL	SEND
	MOV 	A, #46	;TH = 46*0.5 = 23 deg. C
	CALL	SEND
	CLR	RST

	SETB	RST
	MOV	A, #02H	;WRITE TL
	CALL	SEND
	MOV 	A, #34	;TH = 34*0.5 = 17 deg. C
	CALL	SEND
	CLR	RST

CONV:	SETB	RST
	MOV	A, #0EEH;start temperature conversion
	CALL	SEND
	CLR	RST

SENS:	SETB	RST
	MOV	A, #0AAH
	CALL	SEND
	CALL	READ
	PUSH	A
	CLR	RST
	JB	THI, OFF
	JB	TLO, ON
	SJMP	SENS

OFF:	CLR	FURN
	SJMP	SENS
ON:	SETB	FURN
	SJMP	SENS

SEND:	MOV	R0, #08H
NEXT:	CLR	CLK
	RRC	A
	MOV	DQ, C
	SETB	CLK
	DJNZ	R0, NEXT
	RET

READ:	MOV	R0, #08H
NEXT1:	CLR	CLK
	MOV	C, DQ
	RRC	A
	SETB	CLK
	DJNZ	R0, NEXT1
	RRC	A
	RET
	END